const supers=document.getElementById("supers"),searchBar=document.getElementById("search"),loc_List=document.getElementById("locations-dropdown"),city=document.getElementById("location"),intervals=(document.addEventListener("click",e=>console.log(e.target)),document.querySelectorAll("#info-at")),timelineHrs=document.querySelectorAll(".time"),oldChildren=loc_List.children,week=["Sun","Mon","Tues","Wed","Thurs","Fri","Sat"],month=["01","02","03","04","05","06","07","08","09","10","11","12"],apiComm={suggestArr:[],placesArr:[],nineHour_Info:[],long:()=>localStorage.getItem("Coords").split(",",2)[0],lat:()=>localStorage.getItem("Coords").split(",",2)[1],convention:"imperial",currentCondition:"",weather_code:""},displayFields={chosenPlace:"",currentTemp:"",currentApparent:"",locality:()=>localStorage.getItem("chosenPlace").split(",",2)[0],state:()=>localStorage.getItem("chosenPlace").split(",",2)[1],timelineHrs:[],dawnHour:"",duskHour:""},degree=document.getElementById("temperature"),apparent=document.getElementById("apparent"),percipProbEl=document.getElementById("percipProb"),humid=document.getElementById("humid"),vis=document.getElementById("visibility"),windSpeedEl=document.getElementById("windSpeed"),assessWeatherCond=e=>{var t=(new Date).getHours(),o=new Date(apiComm.nineHour_Info[0].sunriseTime).getHours(),n=new Date(apiComm.nineHour_Info[0].sunsetTime).getHours(),e=(displayFields.dawnHour=o,displayFields.duskHour=n,e.toString());const a={condNow:"",condSuffix:""};switch(("6"===e[0]||"8"===e[0])&&e[0]||e){case"1100":case"1101":case"1103":case"2101":case"2102":case"2106":case"2107":case"1102":case"2103":case"2108":a.condNow="Partly Cloudy";break;case"1001":a.condNow="Cloudy";break;case"4000":case"4200":case"4203":case"4204":case"4205":case"4213":case"4214":case"4215":a.condNow="Drizzling";break;case"4001":case"4201":case"4209":case"4208":case"4210":case"4211":case"4202":case"4212":a.condNow="Raining";break;case"5001":case"5100":case"5115":case"5116":case"5117":case"5102":case"5103":case"5104":a.condNow="Flurries";break;case"5000":case"5101":case"5105":case"5106":case"5107":case"5119":case"5120":case"5121":a.condNow="Snowing";break;case"6":case"7105":case"7115":case"7117":case"7106":case"7103":a.condNow="Freezing Rain";break;case"8":a.condNow="Thunderstorm";default:a.condNow="Clear"}e=n<=t&&t<=23||0<=t&&t<o;return displayFields.currentCondition="Clear"!==a.condNow&&"Partly Cloudy"!==a.condNow||!e?a.condNow:a.condNow+"Night"},displayHTML=()=>{const e=[...intervals],t=apiComm["nineHour_Info"],o=t.map(e=>e.temperature),n=document.getElementById("current-info"),a=document.getElementById("last-info");degree.textContent=Math.floor(displayFields.currentTemp)+"°",apparent.textContent=Math.floor(displayFields.currentApparent)+"°",city.textContent=displayFields.locality()+", "+displayFields.state();var{humidity:s,visibility:c,precipitationProbability:r,windSpeed:l}=t[0],c=(n.textContent=Math.floor(displayFields.currentTemp)+"°",a.textContent=Math.floor(t[8].temperature)+"°","imperial"===apiComm.convention?Math.floor(c)+"mi":Math.floor(c)+"km"),l="imperial"===apiComm.convention?Math.floor(l)+"mph":Math.floor(l)+"km/h";vis.textContent=c,windSpeedEl.textContent=l,humid.textContent=Math.floor(s)+"%",percipProbEl.textContent=r+"%",e.forEach((e,t)=>{t=Math.floor(o[t]);e.textContent=t+"°"}),console.log("Object Array:",t)},updateList=t=>{for(var o=t.length;""===searchBar.value&&0<oldChildren.length||0===o&&0<oldChildren.length;)for(let e=0;e<oldChildren.length;e++)loc_List.removeChild(loc_List.firstChild);for(let e=0;e<=o;e++){const n=document.createElement("li");n.setAttribute("class","location"),n.textContent=t[e],loc_List.appendChild(n),0<loc_List.children.length&&loc_List.replaceChild(n,loc_List.children[e]),n.addEventListener("click",()=>{searchBar.value="",displayFields.chosenPlace=n.textContent;const e=apiComm["placesArr"],t=displayFields["chosenPlace"];var o=e.find(e=>e.matchedPlace===t);localStorage.setItem("chosenPlace",displayFields.chosenPlace),localStorage.setItem("Coords",o.coord),getWeather()})}},toggleUnits=()=>{const e=document.getElementById("Fahr"),t=document.getElementById("Cels");(e.classList.contains("selected")||t.classList.contains("selected"))&&(e.classList.toggle("selected"),e.classList.toggle("unselected"),t.classList.toggle("selected"),t.classList.toggle("unselected")),apiComm.convention=e.classList.contains("selected")?"imperial":"metric",getWeather()},createTimelineHours=t=>{const o=new Array(9);for(let e=0;e<o.length;e++){var n=11<t&&t<=23?"PM":"AM",a=12<t&&t<=23?t-12:t;o[e]=23<a?a-24+" "+n:a+" "+n,t+=1}return o},clockTime=()=>{const e=new Date,o=createTimelineHours(e.getHours()),t=document.getElementById("digital");var n=12<e.getHours()?e.getHours()-12:e.getHours(),n=0===n?"12":n,a=e.getMinutes(),s=e.getSeconds(),c=e.getHours()<12?"AM":"PM";t.textContent=n+`:${a<10?"0"+a:""+a} `+c;const r=document.querySelector(".min-hand"),l=document.querySelector(".hour-hand"),i=document.querySelector(".sec-hand");i.style.transform=`rotate(${s/60*360+90}deg)`;c=a/60*360+s/60*6+90,r.style.transform=`rotate(${c}deg)`,s=n/12*360+a/60*30+90,l.style.transform=`rotate(${s}deg)`,c=e.getDate()<10?"0"+e.getDate():""+e.getDate();const d=document.getElementById("day"),m=document.getElementById("date");d.textContent=week[e.getDay()]+" -",m.textContent=` ${month[e.getMonth()]}/`+c;n=document.getElementById("current-hour-at"),a=document.getElementById("last-hour-at");o.includes("0 AM")&&(s=o.findIndex(e=>"0 AM"===e),o[s]="12 AM");const u=[n,...timelineHrs,a];u.forEach((e,t)=>{e.textContent=o[t]})},getWeather=(searchBar.addEventListener("input",async()=>{var e={input:searchBar.value};try{const o=await fetch("/input",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),n=await o.json();apiComm.placesArr=n.placeData,apiComm.suggestArr=n.placeData.map(e=>e.matchedPlace);var t=apiComm["suggestArr"];updateList(t)}catch(e){return e}}),async()=>{var e={unit:apiComm.convention,geolocation:[apiComm.lat(),apiComm.long()]};try{const o=await fetch("/weather",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});var t=await o.json();apiComm.nineHour_Info=t.weatherInfo,apiComm.weather_code=t.weatherInfo[0].weatherCode,displayFields.currentTemp=t.weatherInfo[0].temperature,displayFields.currentApparent=t.weatherInfo[0].temperatureApparent}catch(e){console.log(e)}getPhoto(),getCondIcon(),displayHTML()}),getCondIcon=async()=>{var e=apiComm["weather_code"],e={currCondition:assessWeatherCond(e)};try{const o=await fetch("/code",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});var t=await o.json();console.log(t)}catch(e){console.log(e)}document.getElementById("condition-icon").src+=""},getPhoto=async()=>{var e={state:displayFields.state()};try{const o=await fetch("/photo",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});var t=(await o.json())["urlPhoto"];document.body.style.backgroundImage=`url(${t})`}catch(e){console.log(e)}};getWeather(),supers.addEventListener("click",toggleUnits),setInterval(clockTime,1e3),clockTime();